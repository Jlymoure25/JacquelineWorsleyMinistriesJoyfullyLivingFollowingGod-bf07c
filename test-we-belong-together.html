<!DOCTYPE html>
<html>
<head>
    <title>We Belong Together - SoundCloud Test</title>
</head>
<body>
    <h1>Testing We Belong Together Track (ID: 302259354)</h1>
    
    <div id="status">Testing...</div>
    
    <!-- Hidden audio player -->
    <div style="position: fixed; bottom: -200px; right: -400px; opacity: 0;">
        <iframe id="sc-widget" width="100%" height="166" scrolling="no" frameborder="no" allow="autoplay" 
                src="https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/302259354&auto_play=true&enable_api=true">
        </iframe>
    </div>
    
    <script src="https://w.soundcloud.com/player/api.js"></script>
    <script>
        const status = document.getElementById('status');
        let widget;
        let testResults = [];
        
        function updateStatus(message) {
            console.log(message);
            testResults.push(message);
            status.innerHTML = testResults.join('<br>');
        }
        
        function initWidget() {
            updateStatus('1. Initializing SoundCloud Widget...');
            
            const iframe = document.getElementById('sc-widget');
            if (!iframe) {
                updateStatus('ERROR: iframe not found');
                return;
            }
            
            if (typeof SC === 'undefined' || !SC.Widget) {
                updateStatus('ERROR: SoundCloud API not loaded');
                setTimeout(initWidget, 500);
                return;
            }
            
            widget = SC.Widget(iframe);
            updateStatus('2. Widget created successfully');
            
            widget.bind(SC.Widget.Events.READY, function() {
                updateStatus('3. Widget READY event fired');
                
                // Get track information
                widget.getCurrentSound(function(sound) {
                    if (sound) {
                        updateStatus(`4. Track loaded: "${sound.title}" by ${sound.user.username}`);
                        updateStatus(`   Track ID: ${sound.id}, Duration: ${Math.floor(sound.duration/1000)}s`);
                        
                        // Test playback
                        widget.setVolume(17);
                        updateStatus('5. Volume set to 17%');
                        
                        widget.play();
                        updateStatus('6. Play command sent');
                        
                    } else {
                        updateStatus('4. ERROR: No track information available');
                    }
                });
            });
            
            widget.bind(SC.Widget.Events.PLAY, function() {
                updateStatus('‚úÖ SUCCESS: Audio is now playing!');
                widget.getVolume(function(volume) {
                    updateStatus(`   Current volume: ${volume}%`);
                });
            });
            
            widget.bind(SC.Widget.Events.PAUSE, function() {
                updateStatus('‚è∏Ô∏è Audio paused');
            });
            
            widget.bind(SC.Widget.Events.FINISH, function() {
                updateStatus('üîÑ Track finished - restarting...');
                widget.seekTo(0);
                widget.play();
            });
            
            widget.bind(SC.Widget.Events.ERROR, function(error) {
                updateStatus(`‚ùå ERROR: ${JSON.stringify(error)}`);
            });
            
            // Test if widget is functioning after 3 seconds
            setTimeout(() => {
                widget.isPaused(function(paused) {
                    if (paused) {
                        updateStatus('‚ö†Ô∏è Audio is paused - attempting manual play...');
                        widget.play();
                    } else {
                        updateStatus('‚úÖ Audio playback confirmed');
                    }
                });
            }, 3000);
        }
        
        // Start test when page loads
        window.addEventListener('load', function() {
            setTimeout(initWidget, 1000);
        });
        
        // Emergency play on user interaction
        document.addEventListener('click', function() {
            if (widget) {
                updateStatus('üîß Manual play triggered by click');
                widget.setVolume(17);
                widget.play();
            }
        }, { once: true });
    </script>
</body>
</html>